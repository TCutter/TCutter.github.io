---
author: TCutter
comments: true
date: 2017-11-22
layout: post
categories:
- Tech
tags:
- Node.js 
- module 常用模块系统
---

## util
util 是一个Node.js 核心模块，提供常用函数的集合，用于弥补核心JavaScript 的功能 过于精简的不足。

```var util = require('util'); ```

#### util.inherits
util.inherits(constructor, superConstructor)是一个实现对象间<font color="green">原型继承(只继承原型定义的属性和方法)</font>的函数。
JavaScript 的面向对象特性是基于原型的，与常见的基于类的不同。JavaScript 没有 提供对象继承的语言级别特性，而是通过原型复制来实现的。

```
//index.js
function Base() {
    this.name = 'base';
    this.base = 1991;
    this.sayHello = function () {
        console.log('Hello ' + this.name);
    };
}
Base.prototype.showName = function () {
    console.log(this.name);
};
Base.prototype.age = 18;

function Sub() {
    this.name = 'sub';
}
util.inherits(Sub, Base);
var objBase = new Base();
objBase.showName();
objBase.sayHello();
console.log(objBase);

var objSub = new Sub();
objSub.showName();
//objSub.sayHello(); 
console.log(objSub);
console.log(objSub.age);
console.log(objSub.base);
```

输出：
```
C:\Users\xiao.guo\Desktop\Demo\Node.JS\test>node index.js
base
Hello base
Base { name: 'base', base: 1991, sayHello: [Function] }
sub
Sub { name: 'sub' }
18
undefined
```

#### util.inspect
util.inspect(object,[showHidden],[depth],[colors])是一个将任意对象转换 为字符串的方法，通常用于调试和错误输出。它至少接受一个参数 object，即要转换的对象。

#### 对象判断
- util.isArray(object) 判断是否为数组
- util.isRegExp(object) 判断是否为正则表达式
- util.isDate(object) 判断是否为一个日期
- util.isError(object) 判断是否为一个错误对象

```
util.isDate(new Date()); // true
util.isDate(Date()); // false (without 'new' returns a String)
util.isDate({}); // false

util.isError(new Error()); // true
util.isError(new TypeError()); // true
util.isError({ name: 'Error', message: 'an error occurred' }); // false
```

## fs(文件系统模块)

```var fs = require('fs'); ```

#### 异步和同步
fs模块中的方法均有异步和同步版本，如fs.readFile() 和 fs.readFileSync()。异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息(error)。

```
 //input.txt
  My name is TCutter!  
```

```
//index.js
//异步读取
fs.readFile('input.txt',function(err,data){
    if(err){
       return console.error(err);
    }
    console.log('异步读取 ：'+ data.toString());
});  

//同步读取
var data = fs.readFileSync('input.txt');
console.log("同步读取 : " + data.toString());

console.log('程序执行完毕');
```

输出
```
同步读取 : My name is TCutter! 
程序执行完毕
异步读取 : My name is TCutter!
```

<font color = "red">以下均为异步模式下的语法格式：</font>

#### 打开文件

```
fs.open(path, flags[, mode], callback);
```
参数说明：

- path - 文件路径
- flags -文件打开的行为；r 以读取模式打开文件,a 以追加模式打开文件
- mode - 设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)。可省略
- callback -  回调函数，带有两个参数如：callback(err, fd)

#### 获取文件信息
```
 fs.stat(path, callback)
```

参数说明：
- path - 文件路径。
- callback - 回调函数，带有两个参数如：(err, stats), stats 是 fs.Stats 对象。

stats类中的方法有：
| 方法        | 描述|
| ------------- |:-------------:|
| stats.isFile()      | 	如果是文件返回 true |
| stats.isDirectory() | 如果是目录返回 true|
| stats.isSocket() | 如果是 Socket 返回 true |


#### 写入文件
```
 fs.writeFile(file, data[, options], callback)
```

参数说明：
- file - 文件名或文件描述符。
- data - 要写入文件的数据，可以是 String(字符串) 或 Buffer(流) 对象
- options - 该参数是一个对象，包含 {encoding, mode, flag}
- callback - 回调函数，回调函数只包含错误信息参数(err)，在写入失败时返回

#### 读取文件
```
 fs.read(fd, buffer, offset, length, position, callback)
```

参数说明：
- fd - 通过 fs.open() 方法返回的文件描述符。
- buffer - 数据写入的缓冲区
- offset - 缓冲区写入的写入偏移量
- length - 要从文件中读取的字节数。
- position - 文件读取的起始位置，如果 position 的值为 null，则会从当前文件指针的位置读取。
- callback - 回调函数，有三个参数err, bytesRead, buffer，err 为错误信息， bytesRead 表示读取的字节数，buffer 为缓冲区对象。

#### 关闭文件
```
 fs.close(fd, callback)
```

```
var fs = require("fs");
var buf = new Buffer(1024);

console.log("准备打开文件！");
fs.open('input.txt', 'r+', function(err, fd) {
   if (err) {
       return console.error(err);
   }
   console.log("文件打开成功！");
   console.log("准备读取文件！");
   fs.read(fd, buf, 0, buf.length, 0, function(err, bytes){
      if (err){
         console.log(err);
      }

      // 仅输出读取的字节
      if(bytes > 0){
         console.log(buf.slice(0, bytes).toString());
      }

      // 关闭文件
      fs.close(fd, function(err){
         if (err){
            console.log(err);
         } 
         console.log("文件关闭成功");
      });
   });
});
```